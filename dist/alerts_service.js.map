{"version":3,"sources":["../src/alerts_service.js"],"names":["Tracker","Error","confirmProps","alerts","alertsDep","Dependency","confirmDep","counter","depend","title","message","dismissAfter","onDismiss","actionLabel","onActionClick","type","disableI18n","props","push","key","changed","show","alert","anAlert","namespace","args","options","next","titleSuccess","titleError","messageSuccess","messageError","error","result","additionalProps","onConfirm","onCancel","hideAndInvoke","callback","hideConfirm"],"mappings":"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","file":"alerts_service.js","sourcesContent":["import _ from 'lodash';\n\n\nexport default class {\n  constructor({ Tracker }) {\n    if (!Tracker) {\n      throw new Error('please provide Tracker in your context');\n    }\n    this.confirmProps = {};\n    this.alerts = [];\n    this.alertsDep = new Tracker.Dependency();\n    this.confirmDep = new Tracker.Dependency();\n    this.counter = 0;\n  }\n\n  list() {\n    this.alertsDep.depend();\n    return _.clone(this.alerts); // we provide a copy\n  }\n  /**\n  show an alert.\n\n  The following properties can receive simple strings or translation keys:\n  - title\n  - message\n  - actionLabel\n\n  If manul-i18n is in your context as i18n, the are translated.\n  You can pass an array of translation keys as well. In this case\n  the first key is used that exists in the current translation.\n  This is usefull if you construct your key with an error code\n  which might not be translated yet.\n\n  You can add additional properties which will be available for translations\n\n\n  **/\n  show({\n\n      title,\n      message,\n      dismissAfter = 8000,\n      onDismiss,\n      actionLabel,\n      onActionClick,\n      type = 'default',\n      disableI18n = false,\n      ...props\n    }) {\n    this.alerts.push({\n      title,\n      message,\n      onDismiss,\n      actionLabel,\n      onActionClick,\n      dismissAfter,\n      type,\n      disableI18n,\n      ...props,\n      key: this.counter += 1,\n    });\n    this.alertsDep.changed();\n  }\n\n  error(props) {\n    this.show({\n      ...props,\n      type: 'error',\n    });\n  }\n\n  dismiss(alert) {\n    _.remove(this.alerts, anAlert => anAlert.key === alert.key);\n    this.alertsDep.changed();\n  }\n  /**\n  experimental\n  **/\n  handleCallback(namespace, ...args) {\n    const options = _.isObject(_.first(args)) ? _.first(args) : {};\n    const next = _.isFunction(_.last(args)) ? _.last(args) : _.noop;\n\n    const {\n        props = () => null,\n        titleSuccess = () => [`${namespace}.success.title`, `${namespace}.success`, 'success.title', 'success'],\n        titleError = () => [`${namespace}.error`, 'error.title', 'error'],\n        messageSuccess = () => [`${namespace}.success.message`, 'success.message', null],\n        messageError = error => [`${namespace}.error.message.${error.error}`, `${namespace}.error.message.default`, `error.message.${error.error}`, 'error.message.default', 'error.message'],\n    } = options;\n    return (error, result) => {\n      const additionalProps = props({ error, result });\n      if (error) {\n        this.error({\n          title: titleError(),\n          message: messageError(error),\n          error,\n          result,\n          ...additionalProps,\n        });\n      } else {\n        this.show({\n          title: titleSuccess(),\n          message: messageSuccess(),\n          result,\n          ...additionalProps,\n        });\n      }\n      next(error, result);\n    };\n  }\n\n  confirm({ message, onConfirm, onCancel, ...props }) {\n    const hideAndInvoke = (callback) => {\n      this.hideConfirm();\n      if (callback) {\n        callback();\n      }\n    };\n    this.confirmProps = {\n      message,\n      onCancel: () => hideAndInvoke(onCancel),\n      onConfirm: () => hideAndInvoke(onConfirm),\n      ...props,\n    };\n\n    this.confirmDep.changed();\n  }\n  hideConfirm() {\n    this.confirmDep.changed();\n    this.confirmProps = {};\n  }\n  getConfirm() {\n    this.confirmDep.depend();\n    return this.confirmProps;\n  }\n\n}\n"]}