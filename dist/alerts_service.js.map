{"version":3,"sources":["../src/alerts_service.js"],"names":[],"mappings":"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","file":"alerts_service.js","sourcesContent":["import _ from 'lodash';\n\n\nexport default class {\n  constructor({ Tracker }) {\n    if (!Tracker) {\n      throw new Error('please provide Tracker in your context');\n    }\n    this.confirmProps = {};\n    this.alerts = [];\n    this.alertsDep = new Tracker.Dependency();\n    this.confirmDep = new Tracker.Dependency();\n    this.counter = 0;\n  }\n\n  list() {\n    this.alertsDep.depend();\n    return _.clone(this.alerts); // we provide a copy\n  }\n  /**\n  show an alert.\n\n  The following properties can receive simple strings or translation keys:\n  - title\n  - message\n  - actionLabel\n\n  If manul-i18n is in your context as i18n, the are translated.\n  You can pass an array of translation keys as well. In this case\n  the first key is used that exists in the current translation.\n  This is usefull if you construct your key with an error code\n  which might not be translated yet.\n\n  You can add additional properties which will be available for translations\n\n\n  **/\n  show({\n\n      title,\n      message,\n      dismissAfter = 8000,\n      onDismiss,\n      actionLabel,\n      onActionClick,\n      type = 'default',\n      disableI18n = false,\n      ...props\n    }) {\n    this.alerts.push({\n      title,\n      message,\n      onDismiss,\n      actionLabel,\n      onActionClick,\n      dismissAfter,\n      type,\n      disableI18n,\n      ...props,\n      key: this.counter += 1,\n    });\n    this.alertsDep.changed();\n  }\n\n  error(props) {\n    this.show({\n      ...props,\n      type: 'error',\n    });\n  }\n\n  dismiss(alert) {\n    _.remove(this.alerts, anAlert => anAlert.key === alert.key);\n    this.alertsDep.changed();\n  }\n  /**\n  experimental\n  **/\n  handleCallback(namespace, ...args) {\n    const options = _.isObject(_.first(args)) ? _.first(args) : {};\n    const next = _.isFunction(_.last(args)) ? _.last(args) : _.noop;\n\n    const {\n        props = () => null,\n        titleSuccess = () => [`${namespace}.success.title`, `${namespace}.success`, 'success.title', 'success'],\n        titleError = () => [`${namespace}.error`, 'error.title', 'error'],\n        messageSuccess = () => [`${namespace}.success.message`, 'success.message', null],\n        messageError = error => [`${namespace}.error.message.${error.error}`, `${namespace}.error.message.default`, `error.message.${error.error}`, 'error.message.default', 'error.message'],\n    } = options;\n    return (error, result) => {\n      const additionalProps = props({ error, result });\n      if (error) {\n        this.error({\n          title: titleError(),\n          message: messageError(error),\n          error,\n          result,\n          ...additionalProps,\n        });\n      } else {\n        this.show({\n          title: titleSuccess(),\n          message: messageSuccess(),\n          result,\n          ...additionalProps,\n        });\n      }\n      next(error, result);\n    };\n  }\n\n  confirm({ message, onConfirm, onCancel }) {\n    const hideAndInvoke = (callback) => {\n      this.hideConfirm();\n      if (callback) {\n        callback();\n      }\n    };\n    this.confirmProps = {\n      message,\n      onCancel: () => hideAndInvoke(onCancel),\n      onConfirm: () => hideAndInvoke(onConfirm),\n    };\n\n    this.confirmDep.changed();\n  }\n  hideConfirm() {\n    this.confirmDep.changed();\n    this.confirmProps = {};\n  }\n  getConfirm() {\n    this.confirmDep.depend();\n    return this.confirmProps;\n  }\n\n}\n"]}